# Cardano Stake Pool Simulation

This project simulates the behavior of Cardano stake pools and delegators in a multi-round environment. It models how users with different personas split their stake and how pool operators with different strategies adjust their parameters to maximize profitability. The simulation uses an LLM (e.g., GPT-4o) to imitate the decision-making processes of these agents.

---

## 🔧 Features
- Realistic agent personas cover decentralization advocates, mission-driven operators, and profit maximizers.
- Configurable simulations via command-line arguments for rounds, users, and pools.
- Network-controlled saturation size (`S_OPT`) keeps pool capacity fixed for each experiment.
- Power-law stake distribution ensures heterogeneous initial wealth that sums to `saturation_size * number_of_pools`.
- Users may delegate to multiple pools each round, and allocations are normalized against their total stake.
- Round briefings notify every user of pool parameters, current delegations, saturation size, and the previous round's rewards.
- Uses the OpenAI-compatible API to talk to a local Ollama server by default.
- Detailed logging writes human-readable and structured artifacts for analysis.

---

## 🧩 Network Rules Modeled
- Saturation size is defined by the network in `constants.py` and cannot be changed by users or pools during a run.
- Each user's starting funds follow a power-law distribution while preserving the total `saturation_size * num_pools` balance.
- Delegators may split their stake across any number of pools in a round.
- Before each round, the simulation broadcasts a briefing containing pool parameters (current), per-user delegations (current), the network saturation size, and each pool's reward from the prior round.

---

## 📦 Prerequisites
- Python 3.8 or newer
- An OpenAI-compatible API key with access to a model such as GPT-4o or Groq's LLaMA variants.

---

## 🛠 Installation
1. **Clone the repository:**
   ```bash
   git clone [your-repository-url]
   cd [repository-name]
   ```

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Create a `.env` file** in the project root and add your API key:
   ```env
   OPENAI_API_KEY=your-api-key-here
   ```

---

## ▶️ Usage
1. **Run the simulation** from the command line:
   ```bash
   python main.py --rounds 10 --users 50 --pools 5
   ```
   - `--rounds`: Number of simulation rounds.
   - `--users`: Number of delegators.
   - `--pools`: Number of stake pools.

   Each run creates a timestamped subfolder in `results/` (e.g., `results/20250629-170603/`) containing:
   - `simulation_log.txt`
   - `simulation_results.json`

   Round briefings shared with delegates are captured in both the log and the JSON history (`briefing` field).

2. **Analyze the results** by pointing the analysis script to the generated folder:
   ```bash
   python analyze.py results/20250629-170603
   ```
   This produces an `analysis_chart.png` file summarizing market dynamics.

---

## ⚙️ Configuration
- **Simulation parameters**: Adjust rounds, users, and pools using the command-line arguments.
- **Agent personas**: Modify persona definitions and behavior prompts in `user_agents.py` and `pool_agents.py`.
- **Network constants**: Edit `TOTAL_REWARDS`, `S_OPT`, and `A0` in `constants.py` to explore alternative network settings.
- **LLM selection**: By default the simulation connects to a local Ollama server via the OpenAI-compatible API and loads the `qwen2.5:7b-instruct` model. Override `OLLAMA_MODEL`, `OLLAMA_BASE_URL`, or `LLM_TEMPERATURE` to tune the setup.

---

## 📁 Output
All output is saved inside `results/`:
- `.txt`: Human-readable log of rounds, broadcasts, agent actions, and outcomes.
- `.json`: Structured history including per-round briefings, allocations, and rewards.
- `.png`: Optional charts generated by the analysis script.

---

## 📄 License
MIT License

---

# 卡尔达诺质押池模拟

该项目在多轮环境中模拟 Cardano 质押池与委托者的行为。它刻画了不同人格特质的用户如何分配其质押份额，以及不同策略的池运营者如何调整参数以最大化利润。模拟依赖大语言模型来模仿这些代理的决策过程。

---

## 🔧 功能亮点
- 覆盖去中心化拥护者、使命驱动运营者和利润最大化者等真实代理人格。
- 通过命令行参数灵活配置轮数、用户数量和质押池数量。
- 网络控制的饱和大小（`S_OPT`）对每次实验固定，可避免用户或池自行修改。
- 用户初始资金遵循幂律分布，同时总额保持为 `saturation_size * number_of_pools`。
- 委托者每轮可以把资金拆分到多个质押池，系统会自动规范化其总额不超出余额。
- 每轮开始前都会向所有用户广播通告，包含池参数、用户委托分布、网络饱和大小以及上一轮的池奖励。
- 默认通过 OpenAI 兼容接口调用本地 Ollama 模型。
- 提供详细日志，兼顾可读性和结构化分析需求。

---

## 🧩 网络规则
- 饱和大小在 `constants.py` 中由网络预设，运行过程中用户和池均无法修改。
- 用户初始资金符合幂律分布，并严格保持总额为 `saturation_size * num_pools`。
- 委托者可在任意一轮将资金分配到多个质押池。
- 每轮广播会说明当前池参数、当前的用户委托情况、网络饱和大小以及上一轮的池奖励。

---

## 📦 环境要求
- Python 3.8 及以上版本

---

## 🛠 安装步骤
1. **克隆仓库：**
   ```bash
   git clone [your-repository-url]
   cd [repository-name]
   ```

2. **安装依赖：**
   ```bash
   pip install -r requirements.txt
   ```

3. **创建 `.env` 文件** 并写入 API Key：
   ```env
   OPENAI_API_KEY=your-api-key-here
   ```

---

## ▶️ 使用方式
1. **运行模拟：**
   ```bash
   python main.py --rounds 10 --users 50 --pools 5
   ```
   - `--rounds`：模拟轮数。
   - `--users`：委托者数量。
   - `--pools`：质押池数量。

   每次运行会在 `results/` 下创建时间戳目录（如 `results/20250629-170603/`），其中包含：
   - `simulation_log.txt`
   - `simulation_results.json`

   广播内容同样会写入日志和 JSON (`briefing` 字段)。

2. **结果分析：**
   ```bash
   python analyze.py results/20250629-170603
   ```
   将在对应目录生成 `analysis_chart.png`，展现市场动态概览。

---

## ⚙️ 配置说明
- **模拟参数**：通过命令行调整轮数、用户数和池数。
- **代理人格**：在 `user_agents.py` 与 `pool_agents.py` 中修改人格配置与提示词。
- **网络常量**：在 `constants.py` 中调整 `TOTAL_REWARDS`、`S_OPT`、`A0` 等参数以测试不同网络设置。
- **LLM 选择**：默认通过 OpenAI 兼容接口连接本地 Ollama 并加载 `qwen2.5:7b-instruct`。可通过 `OLLAMA_MODEL`、`OLLAMA_BASE_URL` 或 `LLM_TEMPERATURE` 自定义模型与接口参数。

---

## 📁 输出内容
所有输出保存在 `results/` 目录：
- `.txt`：包含轮次、广播、代理行为与结果的可读日志。
- `.json`：结构化历史数据，含每轮广播及分配详情。
- `.png`：通过分析脚本生成的可选图表。

---

## 📄 许可证
MIT License
