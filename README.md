# Cardano Stake Pool Simulation

This project simulates the behavior of Cardano stake pools and delegators in a multi-round environment. It models how users with different personas split their stake and how pool operators with different strategies adjust their parameters to maximize profitability. The simulation uses an LLM (e.g., GPT-4o) to imitate the decision-making processes of these agents.

---

## ğŸ”§ Features
- Realistic agent personas cover decentralization advocates, mission-driven operators, and profit maximizers.
- Configurable simulations via command-line arguments for rounds, users, and pools.
- Network-controlled saturation size (`S_OPT`) keeps pool capacity fixed for each experiment.
- Power-law stake distribution ensures heterogeneous initial wealth that sums to `saturation_size * number_of_pools`.
- Users may delegate to multiple pools each round, and allocations are normalized against their total stake.
- Round briefings notify every user of pool parameters, current delegations, saturation size, and the previous round's rewards.
- Uses the OpenAI-compatible API to talk to a local Ollama server by default.
- Detailed logging writes human-readable and structured artifacts for analysis.

---

## ğŸ§© Network Rules Modeled
- Saturation size is defined by the network in `constants.py` and cannot be changed by users or pools during a run.
- Each user's starting funds follow a power-law distribution while preserving the total `saturation_size * num_pools` balance.
- Delegators may split their stake across any number of pools in a round.
- Before each round, the simulation broadcasts a briefing containing pool parameters (current), per-user delegations (current), the network saturation size, and each pool's reward from the prior round.

---

## ğŸ“¦ Prerequisites
- Python 3.8 or newer
- An OpenAI-compatible API key with access to a model such as GPT-4o or Groq's LLaMA variants.

---

## ğŸ›  Installation
1. **Clone the repository:**
   ```bash
   git clone [your-repository-url]
   cd [repository-name]
   ```

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

3. **Create a `.env` file** in the project root and add your API key:
   ```env
   OPENAI_API_KEY=your-api-key-here
   ```

---

## â–¶ï¸ Usage
1. **Run the simulation** from the command line:
   ```bash
   python main.py --rounds 10 --users 50 --pools 5
   ```
   - `--rounds`: Number of simulation rounds.
   - `--users`: Number of delegators.
   - `--pools`: Number of stake pools.

   Each run creates a timestamped subfolder in `results/` (e.g., `results/20250629-170603/`) containing:
   - `simulation_log.txt`
   - `simulation_results.json`

   Round briefings shared with delegates are captured in both the log and the JSON history (`briefing` field).

2. **Analyze the results** by pointing the analysis script to the generated folder:
   ```bash
   python analyze.py results/20250629-170603
   ```
   This produces an `analysis_chart.png` file summarizing market dynamics.

---

## âš™ï¸ Configuration
- **Simulation parameters**: Adjust rounds, users, and pools using the command-line arguments.
- **Agent personas**: Modify persona definitions and behavior prompts in `user_agents.py` and `pool_agents.py`.
- **Network constants**: Edit `TOTAL_REWARDS`, `S_OPT`, and `A0` in `constants.py` to explore alternative network settings.
- **LLM selection**: By default the simulation connects to a local Ollama server via the OpenAI-compatible API and loads the `qwen2.5:7b-instruct` model. Override `OLLAMA_MODEL`, `OLLAMA_BASE_URL`, or `LLM_TEMPERATURE` to tune the setup.

---

## ğŸ“ Output
All output is saved inside `results/`:
- `.txt`: Human-readable log of rounds, broadcasts, agent actions, and outcomes.
- `.json`: Structured history including per-round briefings, allocations, and rewards.
- `.png`: Optional charts generated by the analysis script.

---

## ğŸ“„ License
MIT License

---

# å¡å°”è¾¾è¯ºè´¨æŠ¼æ± æ¨¡æ‹Ÿ

è¯¥é¡¹ç›®åœ¨å¤šè½®ç¯å¢ƒä¸­æ¨¡æ‹Ÿ Cardano è´¨æŠ¼æ± ä¸å§”æ‰˜è€…çš„è¡Œä¸ºã€‚å®ƒåˆ»ç”»äº†ä¸åŒäººæ ¼ç‰¹è´¨çš„ç”¨æˆ·å¦‚ä½•åˆ†é…å…¶è´¨æŠ¼ä»½é¢ï¼Œä»¥åŠä¸åŒç­–ç•¥çš„æ± è¿è¥è€…å¦‚ä½•è°ƒæ•´å‚æ•°ä»¥æœ€å¤§åŒ–åˆ©æ¶¦ã€‚æ¨¡æ‹Ÿä¾èµ–å¤§è¯­è¨€æ¨¡å‹æ¥æ¨¡ä»¿è¿™äº›ä»£ç†çš„å†³ç­–è¿‡ç¨‹ã€‚

---

## ğŸ”§ åŠŸèƒ½äº®ç‚¹
- è¦†ç›–å»ä¸­å¿ƒåŒ–æ‹¥æŠ¤è€…ã€ä½¿å‘½é©±åŠ¨è¿è¥è€…å’Œåˆ©æ¶¦æœ€å¤§åŒ–è€…ç­‰çœŸå®ä»£ç†äººæ ¼ã€‚
- é€šè¿‡å‘½ä»¤è¡Œå‚æ•°çµæ´»é…ç½®è½®æ•°ã€ç”¨æˆ·æ•°é‡å’Œè´¨æŠ¼æ± æ•°é‡ã€‚
- ç½‘ç»œæ§åˆ¶çš„é¥±å’Œå¤§å°ï¼ˆ`S_OPT`ï¼‰å¯¹æ¯æ¬¡å®éªŒå›ºå®šï¼Œå¯é¿å…ç”¨æˆ·æˆ–æ± è‡ªè¡Œä¿®æ”¹ã€‚
- ç”¨æˆ·åˆå§‹èµ„é‡‘éµå¾ªå¹‚å¾‹åˆ†å¸ƒï¼ŒåŒæ—¶æ€»é¢ä¿æŒä¸º `saturation_size * number_of_pools`ã€‚
- å§”æ‰˜è€…æ¯è½®å¯ä»¥æŠŠèµ„é‡‘æ‹†åˆ†åˆ°å¤šä¸ªè´¨æŠ¼æ± ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§„èŒƒåŒ–å…¶æ€»é¢ä¸è¶…å‡ºä½™é¢ã€‚
- æ¯è½®å¼€å§‹å‰éƒ½ä¼šå‘æ‰€æœ‰ç”¨æˆ·å¹¿æ’­é€šå‘Šï¼ŒåŒ…å«æ± å‚æ•°ã€ç”¨æˆ·å§”æ‰˜åˆ†å¸ƒã€ç½‘ç»œé¥±å’Œå¤§å°ä»¥åŠä¸Šä¸€è½®çš„æ± å¥–åŠ±ã€‚
- é»˜è®¤é€šè¿‡ OpenAI å…¼å®¹æ¥å£è°ƒç”¨æœ¬åœ° Ollama æ¨¡å‹ã€‚
- æä¾›è¯¦ç»†æ—¥å¿—ï¼Œå…¼é¡¾å¯è¯»æ€§å’Œç»“æ„åŒ–åˆ†æéœ€æ±‚ã€‚

---

## ğŸ§© ç½‘ç»œè§„åˆ™
- é¥±å’Œå¤§å°åœ¨ `constants.py` ä¸­ç”±ç½‘ç»œé¢„è®¾ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ç”¨æˆ·å’Œæ± å‡æ— æ³•ä¿®æ”¹ã€‚
- ç”¨æˆ·åˆå§‹èµ„é‡‘ç¬¦åˆå¹‚å¾‹åˆ†å¸ƒï¼Œå¹¶ä¸¥æ ¼ä¿æŒæ€»é¢ä¸º `saturation_size * num_pools`ã€‚
- å§”æ‰˜è€…å¯åœ¨ä»»æ„ä¸€è½®å°†èµ„é‡‘åˆ†é…åˆ°å¤šä¸ªè´¨æŠ¼æ± ã€‚
- æ¯è½®å¹¿æ’­ä¼šè¯´æ˜å½“å‰æ± å‚æ•°ã€å½“å‰çš„ç”¨æˆ·å§”æ‰˜æƒ…å†µã€ç½‘ç»œé¥±å’Œå¤§å°ä»¥åŠä¸Šä¸€è½®çš„æ± å¥–åŠ±ã€‚

---

## ğŸ“¦ ç¯å¢ƒè¦æ±‚
- Python 3.8 åŠä»¥ä¸Šç‰ˆæœ¬

---

## ğŸ›  å®‰è£…æ­¥éª¤
1. **å…‹éš†ä»“åº“ï¼š**
   ```bash
   git clone [your-repository-url]
   cd [repository-name]
   ```

2. **å®‰è£…ä¾èµ–ï¼š**
   ```bash
   pip install -r requirements.txt
   ```

3. **åˆ›å»º `.env` æ–‡ä»¶** å¹¶å†™å…¥ API Keyï¼š
   ```env
   OPENAI_API_KEY=your-api-key-here
   ```

---

## â–¶ï¸ ä½¿ç”¨æ–¹å¼
1. **è¿è¡Œæ¨¡æ‹Ÿï¼š**
   ```bash
   python main.py --rounds 10 --users 50 --pools 5
   ```
   - `--rounds`ï¼šæ¨¡æ‹Ÿè½®æ•°ã€‚
   - `--users`ï¼šå§”æ‰˜è€…æ•°é‡ã€‚
   - `--pools`ï¼šè´¨æŠ¼æ± æ•°é‡ã€‚

   æ¯æ¬¡è¿è¡Œä¼šåœ¨ `results/` ä¸‹åˆ›å»ºæ—¶é—´æˆ³ç›®å½•ï¼ˆå¦‚ `results/20250629-170603/`ï¼‰ï¼Œå…¶ä¸­åŒ…å«ï¼š
   - `simulation_log.txt`
   - `simulation_results.json`

   å¹¿æ’­å†…å®¹åŒæ ·ä¼šå†™å…¥æ—¥å¿—å’Œ JSON (`briefing` å­—æ®µ)ã€‚

2. **ç»“æœåˆ†æï¼š**
   ```bash
   python analyze.py results/20250629-170603
   ```
   å°†åœ¨å¯¹åº”ç›®å½•ç”Ÿæˆ `analysis_chart.png`ï¼Œå±•ç°å¸‚åœºåŠ¨æ€æ¦‚è§ˆã€‚

---

## âš™ï¸ é…ç½®è¯´æ˜
- **æ¨¡æ‹Ÿå‚æ•°**ï¼šé€šè¿‡å‘½ä»¤è¡Œè°ƒæ•´è½®æ•°ã€ç”¨æˆ·æ•°å’Œæ± æ•°ã€‚
- **ä»£ç†äººæ ¼**ï¼šåœ¨ `user_agents.py` ä¸ `pool_agents.py` ä¸­ä¿®æ”¹äººæ ¼é…ç½®ä¸æç¤ºè¯ã€‚
- **ç½‘ç»œå¸¸é‡**ï¼šåœ¨ `constants.py` ä¸­è°ƒæ•´ `TOTAL_REWARDS`ã€`S_OPT`ã€`A0` ç­‰å‚æ•°ä»¥æµ‹è¯•ä¸åŒç½‘ç»œè®¾ç½®ã€‚
- **LLM é€‰æ‹©**ï¼šé»˜è®¤é€šè¿‡ OpenAI å…¼å®¹æ¥å£è¿æ¥æœ¬åœ° Ollama å¹¶åŠ è½½ `qwen2.5:7b-instruct`ã€‚å¯é€šè¿‡ `OLLAMA_MODEL`ã€`OLLAMA_BASE_URL` æˆ– `LLM_TEMPERATURE` è‡ªå®šä¹‰æ¨¡å‹ä¸æ¥å£å‚æ•°ã€‚

---

## ğŸ“ è¾“å‡ºå†…å®¹
æ‰€æœ‰è¾“å‡ºä¿å­˜åœ¨ `results/` ç›®å½•ï¼š
- `.txt`ï¼šåŒ…å«è½®æ¬¡ã€å¹¿æ’­ã€ä»£ç†è¡Œä¸ºä¸ç»“æœçš„å¯è¯»æ—¥å¿—ã€‚
- `.json`ï¼šç»“æ„åŒ–å†å²æ•°æ®ï¼Œå«æ¯è½®å¹¿æ’­åŠåˆ†é…è¯¦æƒ…ã€‚
- `.png`ï¼šé€šè¿‡åˆ†æè„šæœ¬ç”Ÿæˆçš„å¯é€‰å›¾è¡¨ã€‚

---

## ğŸ“„ è®¸å¯è¯
MIT License
